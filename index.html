<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Savings Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #calculator, #resultPage {
            display: none;
        }
        #calculator.active, #resultPage.active {
            display: block;
        }
        button {
            background-color: #40A7DD;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3690c4;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px;
        }
    </style>
</head>
<body>

<div id="calculator" class="active">
    <h1>Retirement Savings Calculator</h1>
    <label for="currentRRSP">Current Registered Retirement Savings:</label>
    <input type="number" id="currentRRSP"><br><br>
    
    <label for="currentTFSA">Current TFSA Savings:</label>
    <input type="number" id="currentTFSA"><br><br>
    
    <label for="currentNonReg">Current Non-Registered Savings:</label>
    <input type="number" id="currentNonReg"><br><br>

    <label for="monthlyContribution">Monthly Contribution:</label>
    <input type="number" id="monthlyContribution"><br><br>
    
    <label for="annualGrowthRate">Annual Growth Rate (%):</label>
    <input type="number" id="annualGrowthRate" step="0.01"><br><br>
    
    <label for="retirementAge">Desired Retirement Age:</label>
    <input type="number" id="retirementAge"><br><br>

    <button onclick="calculate()">Calculate</button>
</div>

<div id="resultPage">
    <h2>Retirement Savings Projection</h2>
    <p id="result"></p>
    
    <h3>Savings Growth Chart</h3>
    <canvas id="growthChart" width="400" height="200"></canvas>
    
    <h3>Savings Breakdown (Pie Chart)</h3>
    <canvas id="cashFlowChart" width="400" height="200"></canvas>
    
    <h3>Retirement Savings Growth Table</h3>
    <table id="growthTable"></table>
    
    <br>
    <button onclick="goBack()">Back</button>
    <button onclick="saveAsPDF()">Download as PDF</button>
</div>

<script>
let cashFlowChart;

function calculate() {
    const currentRRSP = parseFloat(document.getElementById('currentRRSP').value) || 0;
    const currentTFSA = parseFloat(document.getElementById('currentTFSA').value) || 0;
    const currentNonReg = parseFloat(document.getElementById('currentNonReg').value) || 0;
    const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value) || 0;
    const annualGrowthRate = parseFloat(document.getElementById('annualGrowthRate').value) / 100 || 0;
    const retirementAge = parseInt(document.getElementById('retirementAge').value);

    const currentAge = 30; // Assume user is 30 years old for this example
    const yearsToRetirement = retirementAge - currentAge;

    let totalFutureValue = currentRRSP + currentTFSA + currentNonReg;
    const growthData = [];

    for (let i = 1; i <= yearsToRetirement; i++) {
        totalFutureValue += (monthlyContribution * 12);
        totalFutureValue += totalFutureValue * annualGrowthRate;

        growthData.push({ year: currentAge + i, value: totalFutureValue });
    }

    document.getElementById('result').textContent = `By age ${retirementAge}, your total retirement savings will be: $${totalFutureValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

    createGrowthChart(growthData);
    createGrowthTable(growthData);
    createCashFlowChart(totalFutureValue, retirementAge);

    document.getElementById('calculator').classList.remove('active');
    document.getElementById('resultPage').classList.add('active');
}

function createGrowthChart(growthData) {
    const ctx = document.getElementById('growthChart').getContext('2d');
    const labels = growthData.map(row => row.year);
    const values = growthData.map(row => row.value);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Retirement Savings Growth',
                data: values,
                borderColor: '#40A7DD',
                fill: false
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return formatCurrency(tooltipItem.raw);
                        }
                    }
                }
            }
        }
    });
}

function formatCurrency(value) {
    return `$${value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
}

function createGrowthTable(tableData) {
    const table = document.getElementById('growthTable');
    table.innerHTML = '<tr><th>Age</th><th>Retirement Savings Value</th></tr>';

    tableData.forEach(row => {
        const rowElement = document.createElement('tr');
        const ageCell = document.createElement('td');
        const valueCell = document.createElement('td');
        
        ageCell.textContent = row.year;
        valueCell.textContent = formatCurrency(row.value);

        rowElement.appendChild(ageCell);
        rowElement.appendChild(valueCell);
        table.appendChild(rowElement);
    });
}

function createCashFlowChart(totalFutureValue) {
    const ctx = document.getElementById('cashFlowChart').getContext('2d');
    if (cashFlowChart) {
        cashFlowChart.destroy();
    }

    cashFlowChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Registered Retirement Savings', 'TFSAs', 'Non-Registered Savings'],
            datasets: [{
                data: [
                    totalFutureValue / 3,  
                    totalFutureValue / 3,
                    totalFutureValue / 3
                ],
                backgroundColor: ['blue', 'green', 'pink'],
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            return formatCurrency(tooltipItem.raw);
                        }
                    }
                }
            }
        }
    });
}

function goBack() {
    document.getElementById('resultPage').classList.remove('active');
    document.getElementById('calculator').classList.add('active');
}

function saveAsPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.text('Your Estimated Retirement Savings', 20, 20);
    doc.text(document.getElementById('result').textContent, 20, 30);

    const canvas = document.getElementById('growthChart');
    const canvasImg = canvas.toDataURL('image/jpeg', 1.0);
    doc.addImage(canvasImg, 'JPEG', 20, 40, 170, 90);

    const canvasCashFlow = document.getElementById('cashFlowChart');
    const cashFlowImg = canvasCashFlow.toDataURL('image/jpeg', 1.0);
    doc.addPage();
    doc.addImage(cashFlowImg, 'JPEG', 20, 20, 170, 90);

    doc.save('retirement_savings_report.pdf');
}
</script>
</body>
</html>
