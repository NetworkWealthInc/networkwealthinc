<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Savings Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #calculator, #resultPage {
            display: none;
        }
        #calculator.active, #resultPage.active {
            display: block;
        }
        button {
            background-color: #40A7DD;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3690c4;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px;
        }
    </style>
</head>
<body>

<div id="calculator" class="active">
    <h1>Retirement Savings Calculator</h1>

    <label for="currentAge">Current Age:</label>
    <input type="number" id="currentAge"><br><br>

    <label for="currentRRSP">Current Registered Retirement Savings:</label>
    <input type="number" id="currentRRSP"><br><br>
    
    <label for="currentTFSA">Current TFSA Savings:</label>
    <input type="number" id="currentTFSA"><br><br>
    
    <label for="currentNonReg">Current Non-Registered Savings:</label>
    <input type="number" id="currentNonReg"><br><br>

    <label for="contributionType">Contribution Type:</label>
    <select id="contributionType">
        <option value="monthly">Monthly Contribution</option>
        <option value="annual">Annual Contribution</option>
    </select><br><br>

    <label for="contributionAmount">Contribution Amount:</label>
    <input type="number" id="contributionAmount"><br><br>
    
    <label for="annualGrowthRate">Annual Growth Rate (%):</label>
    <input type="number" id="annualGrowthRate" step="0.01"><br><br>
    
    <label for="retirementAge">Desired Retirement Age:</label>
    <input type="number" id="retirementAge"><br><br>

    <button onclick="calculate()">Calculate</button>
</div>

<div id="resultPage">
    <h2>Retirement Savings Projection</h2>
    <p id="result"></p>
    
    <h3>Savings Growth Chart</h3>
    <canvas id="growthChart" width="400" height="200"></canvas>
    
    <h3>Savings Breakdown (Pie Chart)</h3>
    <canvas id="cashFlowChart" width="400" height="200"></canvas>
    
    <h3>Retirement Savings Growth Table</h3>
    <table id="growthTable"></table>
    
    <br>
    <button onclick="goBack()">Back</button>
    <button onclick="saveAsPDF()">Download as PDF</button>
</div>

<script>
let cashFlowChart;

function calculate() {
    const currentAge = parseInt(document.getElementById('currentAge').value) || 30;
    const currentRRSP = parseFloat(document.getElementById('currentRRSP').value) || 0;
    const currentTFSA = parseFloat(document.getElementById('currentTFSA').value) || 0;
    const currentNonReg = parseFloat(document.getElementById('currentNonReg').value) || 0;
    const contributionType = document.getElementById('contributionType').value;
    const contributionAmount = parseFloat(document.getElementById('contributionAmount').value) || 0;
    const annualGrowthRate = parseFloat(document.getElementById('annualGrowthRate').value) / 100 || 0;
    const retirementAge = parseInt(document.getElementById('retirementAge').value);

    const yearsToRetirement = retirementAge - currentAge;

    // Separate future values for each account type
    let totalFutureRRSP = currentRRSP;
    let totalFutureTFSA = currentTFSA;
    let totalFutureNonReg = currentNonReg;

    const growthDataRRSP = [];
    const growthDataTFSA = [];
    const growthDataNonReg = [];

    for (let i = 1; i <= yearsToRetirement; i++) {
        if (contributionType === "monthly") {
            totalFutureRRSP += (contributionAmount * 12) / 3;
            totalFutureTFSA += (contributionAmount * 12) / 3;
            totalFutureNonReg += (contributionAmount * 12) / 3;
        } else if (contributionType === "annual") {
            totalFutureRRSP += contributionAmount / 3;
            totalFutureTFSA += contributionAmount / 3;
            totalFutureNonReg += contributionAmount / 3;
        }

        totalFutureRRSP += totalFutureRRSP * annualGrowthRate;
        totalFutureTFSA += totalFutureTFSA * annualGrowthRate;
        totalFutureNonReg += totalFutureNonReg * annualGrowthRate;

        growthDataRRSP.push({ year: currentAge + i, value: totalFutureRRSP });
        growthDataTFSA.push({ year: currentAge + i, value: totalFutureTFSA });
        growthDataNonReg.push({ year: currentAge + i, value: totalFutureNonReg });
    }

    document.getElementById('result').textContent = `By age ${retirementAge}, your total retirement savings will be: $${(totalFutureRRSP + totalFutureTFSA + totalFutureNonReg).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

    createStackedColumnChart(growthDataRRSP, growthDataTFSA, growthDataNonReg);
    createGrowthTable(growthDataRRSP, growthDataTFSA, growthDataNonReg);
    createCashFlowChart(totalFutureRRSP, totalFutureTFSA, totalFutureNonReg);

    document.getElementById('calculator').classList.remove('active');
    document.getElementById('resultPage').classList.add('active');
}

function createStackedColumnChart(dataRRSP, dataTFSA, dataNonReg) {
    const ctx = document.getElementById('growthChart').getContext('2d');
    const labels = dataRRSP.map(row => row.year);

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'RRSP',
                    data: dataRRSP.map(row => row.value),
                    backgroundColor: 'blue',
                },
                {
                    label: 'TFSA',
                    data: dataTFSA.map(row => row.value),
                    backgroundColor: 'green',
                },
                {
                    label: 'Non-Registered',
                    data: dataNonReg.map(row => row.value),
                    backgroundColor: 'pink',
                }
            ]
        },
        options: {
            scales: {
                x: {
                    stacked: true
                },
                y: {
                    stacked: true
                }
            },
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return formatCurrency(tooltipItem.raw);
                        }
                    }
                }
            }
        }
    });
}

function formatCurrency(value) {
    return `$${value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
}

function createGrowthTable(dataRRSP, dataTFSA, dataNonReg) {
    const table = document.getElementById('growthTable');
    table.innerHTML = '<tr><th>Age</th><th>Retirement Savings Value</th></tr>';

    dataRRSP.forEach((row, index) => {
        const rowElement = document.createElement('tr');
        const ageCell = document.createElement('td');
        const valueCell = document.createElement('td');
        
        ageCell.textContent = row.year;
        const totalValue = dataRRSP[index].value + dataTFSA[index].value + dataNonReg[index].value;
        valueCell.textContent = formatCurrency(totalValue);

        rowElement.appendChild(ageCell);
        rowElement.appendChild(valueCell);
        table.appendChild(rowElement);
    });
}

function createCashFlowChart(rrsp, tfsa, nonReg) {
    const ctx = document.getElementById('cashFlowChart').getContext('2d');

    if (cashFlowChart) {
        cashFlowChart.destroy();
    }

    cashFlowChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['RRSP', 'TFSA', 'Non-Registered'],
            datasets: [{
                data: [rrsp, tfsa, nonReg],
                backgroundColor: ['blue', 'green', 'pink']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return formatCurrency(tooltipItem.raw);
                        }
                    }
                }
            }
        }
    });
}

function goBack() {
    document.getElementById('resultPage').classList.remove('active');
    document.getElementById('calculator').classList.add('active');
}

function saveAsPDF() {
    const doc = new jspdf.jsPDF();
    doc.text(document.getElementById('result').textContent, 10, 10);
    doc.save('retirement_savings_report.pdf');
}
</script>

</body>
</html>
